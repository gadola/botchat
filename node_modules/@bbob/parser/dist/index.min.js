!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t=t||self).BbobParser={})}(this,(function(t){"use strict";function n(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function e(t,n){return t(n={exports:{}},n.exports),n.exports}var r=e((function(t,n){n.__esModule=!0,n.BACKSLASH=n.PLACEHOLDER_SPACE=n.PLACEHOLDER_SPACE_TAB=n.SLASH=n.CLOSE_BRAKET=n.OPEN_BRAKET=n.SPACE=n.QUOTEMARK=n.EQ=n.TAB=n.R=n.F=n.N=void 0;n.N="\n";n.TAB="\t";n.F="\f";n.R="\r";n.EQ="=";n.QUOTEMARK='"';n.SPACE=" ";n.OPEN_BRAKET="[";n.CLOSE_BRAKET="]";n.SLASH="/";n.BACKSLASH="\\";n.PLACEHOLDER_SPACE_TAB="    ";n.PLACEHOLDER_SPACE=" "}));n(r);var o=r.BACKSLASH,i=r.SLASH,u=r.CLOSE_BRAKET,a=r.OPEN_BRAKET,s=r.SPACE,f=r.QUOTEMARK,c=r.EQ,l=r.TAB,g=r.N,p=e((function(t,n){n.__esModule=!0,n.isEOL=n.isStringNode=n.isTagNode=n.getNodeLength=n.appendToNode=n.attrValue=n.attrsToString=void 0;var e=function(t){return"object"==typeof t&&!!t.tag};n.isTagNode=e;var o=function(t){return"string"==typeof t};n.isStringNode=o;n.isEOL=function(t){return t===r.N};n.getNodeLength=function t(n){return e(n)?n.content.reduce((function(n,e){return n+t(e)}),0):o(n)?n.length:0};n.appendToNode=function(t,n){t.content.push(n)};var i=function(t){return t.replace(/"/g,"&quot;")},u=function(t,n){var e=typeof n,r={boolean:function(){return n?""+t:""},number:function(){return t+'="'+n+'"'},string:function(){return t+'="'+i(n)+'"'},object:function(){return t+'="'+i(JSON.stringify(n))+'"'}};return r[e]?r[e]():""};n.attrValue=u;n.attrsToString=function(t){return void 0===t?"":Object.keys(t).reduce((function(n,e){return[].concat(n,[u(e,t[e])])}),[""]).join(" ")}}));n(p);var h=e((function(t,n){function e(t,n){for(var e=0;n.length>e;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}n.__esModule=!0,n.default=n.TagNode=void 0;var o=function(){function t(t,n,e){this.tag=t.toLowerCase(),this.attrs=n,this.content=[].concat(e)}var n,o,i,u=t.prototype;return u.attr=function(t,n){return void 0!==n&&(this.attrs[t]=n),this.attrs[t]},u.append=function(t){return(0,p.appendToNode)(this,t)},u.toString=function(){var t=r.OPEN_BRAKET,n=r.CLOSE_BRAKET;return t+this.tag+n+this.content.reduce((function(t,n){return t+""+n}),"")+t+r.SLASH+this.tag+n},n=t,(o=[{key:"length",get:function(){return(0,p.getNodeLength)(this)}}])&&e(n.prototype,o),i&&e(n,i),t}();n.TagNode=o,o.create=function(t,n,e){return void 0===n&&(n={}),void 0===e&&(e=[]),new o(t,n,e)},o.isOf=function(t,n){return t.tag===n},n.default=o})),d=n(h),v=h.TagNode,T=function(t){return t.value},A=function(t){return T(t).charCodeAt(0)===i.charCodeAt(0)},E=function(){function t(t,n,e,r){this.type=t+"",this.value=n+"",this.line=Number(e),this.row=Number(r)}var n=t.prototype;return n.isEmpty=function(){return!!this.type},n.isText=function(){return"space"===(t=this).type||"new-line"===t.type||"word"===t.type;var t},n.isTag=function(){return"tag"===this.type},n.isAttrName=function(){return"attr-name"===this.type},n.isAttrValue=function(){return"attr-value"===this.type},n.isStart=function(){return!A(this)},n.isEnd=function(){return A(this)},n.getName=function(){return n=T(t=this),A(t)?n.slice(1):n;var t,n},n.getValue=function(){return T(this)},n.getLine=function(){return this.line},n.getColumn=function(){return this.row},n.toString=function(){return t=a,t+=T(this),t+=u;var t},t}(),N=function(t,n){var e={pos:0,length:t.length},r=function(){e.pos+=1,n&&n.onSkip&&n.onSkip()},o=function(){return e.length>e.pos},i=function(){return t.substr(e.pos)},u=function(){return t[e.pos]};return{skip:r,hasNext:o,isLast:function(){return e.pos===e.length},grabWhile:function(n){var i=0;if(o())for(i=e.pos;o()&&n(u());)r();return t.substr(i,e.pos-i)},getNext:function(){return t[e.pos+1]},getPrev:function(){return t[e.pos-1]},getCurr:u,getRest:i,substrUntilChar:function(t){var n=i(),e=n.indexOf(t);return 0>e?"":n.substr(0,e)}}},L=function(t){void 0===t&&(t=[]);var n=t;return{getLast:function(){return n.length?n[n.length-1]:null},flushLast:function(){return!!n.length&&n.pop()},push:function(t){return n.push(t)},toArray:function(){return n}}},S=function(t,n,e,r){return void 0===e&&(e=0),void 0===r&&(r=0),new E(t,n,e,r)};function y(t,n){void 0===n&&(n={});var e=0,r=0,p=-1,h=Array(Math.floor(t.length)),d=n.openTag||a,v=n.closeTag||u,T=n.enableEscapeTags,A=[v,d,f,o,s,l,c,g,"!"],E=[d,s,l,g],L=[s,l],y=[c,s,l],b=function(t){return L.indexOf(t)>=0},O=function(t){return-1===E.indexOf(t)},C=function(t){return t===d||t===v||t===o},x=function(t){return t===o},k=function(t){n.onToken&&n.onToken(t),h[p+=1]=t},_=function(t){for(var n=null,i=!1,u=[],a=N(t),s=function(t){var e=t===c,r=b(t),u=a.getPrev(),s=a.getNext(),l=u===o;return null===n?!1===(e||r||a.isLast()):!(!i||!function(t){return y.indexOf(t)>=0}(t))||!!(t!==f||l||(i=!i)||s===c||b(s))&&!1===(e||r)},l=function(){var t=a.grabWhile(s),i=a.getCurr();if(null===n)n=t;else if(b(i)||i===f||!a.hasNext()){var c=function(t){return t.replace(o+f,f)}(function(t,n){for(;t.charAt(0)===n;)t=t.substring(1);for(;t.charAt(t.length-1)===n;)t=t.substring(0,t.length-1);return t}(t,f));u.push(S("attr-value",c,e,r))}else u.push(S("attr-name",t,e,r));a.skip()};a.hasNext();)l();return{tag:n,attrs:u}},m=N(t,{onSkip:function(){r++}}),P=function(){var t=m.getCurr(),n=m.getNext();if(t===g)m.skip(),e++,k(S("new-line",t,e,r=0));else if(b(t)){var o=m.grabWhile(b);k(S("space",o,e,r))}else if(T&&x(t)&&C(n))m.skip(),m.skip(),k(S("word",n,e,r));else if(t===d){m.skip();var u=m.substrUntilChar(v),a=0===u.length||u.indexOf(d)>=0;if(A.indexOf(n)>=0||a||m.isLast())k(S("word",t,e,r));else{var s=m.grabWhile((function(t){return t!==v}));if(m.skip(),-1===s.indexOf(c)||s[0]===i)k(S("tag",s,e,r));else{var f=_(s);k(S("tag",f.tag,e,r)),f.attrs.map(k)}}}else if(t===v)m.skip(),k(S("word",t,e,r));else if(O(t))if(T&&x(t)&&!C(n))m.skip(),k(S("word",t,e,r));else{var l=m.grabWhile((function(t){return T?O(t)&&!x(t):O(t)}));k(S("word",l,e,r))}};return{tokenize:function(){for(;m.hasNext();)P();return h.length=p+1,h},isTokenNested:function(n){var e=d+i+n.getValue();return t.indexOf(e)>-1}}}var b=function(t,n){void 0===n&&(n={});var e=n,r=null,o=L(),i=L(),u=L(),a=L(),s={},f=function(){u.flushLast()&&a.flushLast()},c=function(t){var n;(n=i.getLast(),n?n.content:o.toArray()).push(t)},l=function(t){f();var n=d.create(t.getValue()),e=function(t){return void 0===s[t.getValue()]&&(s[t.getValue()]=r.isTokenNested(t)),s[t.getValue()]}(t);u.push(n),e?i.push(n):c(n)},g=function(t){t.isStart()&&l(t),t.isEnd()&&function(t){f();var n=i.flushLast();if(n)c(n);else if(e.onError){var r=t.getValue(),o=t.getLine(),u=t.getColumn();e.onError({message:"Inconsistent tag '"+r+"' on line "+o+" and column "+u,tagName:r,lineNumber:o,columnNumber:u})}}(t)},p=function(t){var n=u.getLast(),e=t.getValue(),r=!!s[t];if(n)if(t.isAttrName())a.push(e),n.attr(a.getLast(),"");else if(t.isAttrValue()){var o=a.getLast();o?(n.attr(o,e),a.flushLast()):n.attr(e,e)}else t.isText()?r?n.append(e):c(e):t.isTag()&&c(""+t);else t.isText()?c(e):t.isTag()&&c(""+t)};(r=(n.createTokenizer?n.createTokenizer:y)(t,{onToken:function(t){var n;!t.isTag()||(n=t.getName(),e.onlyAllowTags&&e.onlyAllowTags.length&&0>e.onlyAllowTags.indexOf(n))?p(t):g(t)},onlyAllowTags:e.onlyAllowTags,openTag:e.openTag,closeTag:e.closeTag,enableEscapeTags:e.enableEscapeTags})).tokenize();return o.toArray()};t.TagNode=v,t.default=b,t.parse=b,Object.defineProperty(t,"__esModule",{value:!0})}));
